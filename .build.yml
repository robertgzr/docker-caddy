image: 'fedora/30'
packages:
  - buildah
sources:
  - https://git.sr.ht/~robertgzr/easycaddy
secrets:
  - 985dd57c-ae11-46ee-9419-45ff06078c19
tasks:
  - build: |
      cd easycaddy
      sudo ./make.sh build
  - deploy: |
      . ~/.easycaddy_secrets
      set +x
      sudo buildah login --username ${DOCKER_USERNAME} --password ${DOCKER_PASSWORD} docker.io
      set -x
      cd easycaddy
      sudo ./make.sh push
      ./make.sh webhook
      ./make.sh upload
